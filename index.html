<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoPe√ßas Veloz - Sua Loja de Pe√ßas</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <link rel="stylesheet" href="style.css?v=2.1">
</head>
<body>

    <header class="main-header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <i class="ph ph-car-profile"></i>
                AutoPe√ßas <span>Veloz</span>
            </a>

            <div class="search-container">
                <input type="text" id="search-input" placeholder="O que voc√™ est√° procurando?">
                
                <button class="search-button" id="search-button" aria-label="Buscar">
                    <i class="ph ph-magnifying-glass"></i>
                </button>
                
            
                <div class="search-dropdown-menu" id="search-dropdown-menu">
                    <a href="#" data-value="">Todas as Categorias</a>
                    <a href="#" data-value="Motor">Motor</a>
                    <a href="#" data-value="Freios">Freios</a>
                    <a href="#" data-value="Suspens√£o">Suspens√£o</a>
                    <a href="#" data-value="El√©trica">El√©trica</a>
                    <a href="#" data-value="C√¢mbio">C√¢mbio</a>
                    <a href="#" data-value="Acess√≥rios">Acess√≥rios</a>
                </div>
            </div>

            <div class="header-actions">

                <div id="box-sino" class="notification-container" onclick="abrirNotificacoes()">
        <i class="ph ph-bell bell-icon"></i>
        <span id="notif-badge" class="badge">0</span>
        
        <div id="notif-dropdown" class="notif-dropdown" onclick="event.stopPropagation()">
            <div class="notif-header">
                Atualiza√ß√µes
                <small style="cursor:pointer; color:#3498db;" onclick="marcarLidas()">Limpar</small>
            </div>
            <div id="notif-list" class="notif-list">
                </div>
        </div>
    </div>

                <a href="afiliado_login.html" class="action-button" id="btn-login-header">
                    <i class="ph ph-user"></i>
                    <span>Entrar</span>
                </a>
                <a href="cart.html" class="action-button cart-button">
                    <i class="ph ph-shopping-cart"></i>
                    <span>Carrinho</span>
                    <span>0</span> 
                </a>
            </div>
        </div>
    </header>

	<section class="hero-banner">
        <div class="slider-container">
            
            <div class="slide active" style="background-image: url('https://images.unsplash.com/photo-1486262715619-67b85e0b08d3?q=80&w=1920&auto=format&fit=crop');">
                <div class="slide-content">
                    <h2>Motores de Alta Performance</h2>
                    <p>Encontre as melhores pe√ßas para turbinar seu ve√≠culo.</p>
                    <a href="#search-track" class="btn-banner">Ver Ofertas</a>
                </div>
            </div>

            <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1492144534655-ae79c964c9d7?q=80&w=1920&auto=format&fit=crop');">
                <div class="slide-content">
                    <h2>Seguran√ßa em Primeiro Lugar</h2>
                    <p>Pastilhas e Discos de Freio com tecnologia de ponta.</p>
                    <a href="#search-track" class="btn-banner">Confira Freios</a>
                </div>
            </div>

            <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1562426503-12e6fd634973?q=80&w=1920&auto=format&fit=crop');">
                <div class="slide-content">
                    <h2>Troca de √ìleo e Filtros</h2>
                    <p>Mantenha a manuten√ß√£o do seu carro em dia com os melhores pre√ßos.</p>
                    <a href="#search-track" class="btn-banner">Comprar Kit</a>
                </div>
            </div>

            <button class="prev-slide" onclick="mudarSlide(-1)">&#10094;</button>
            <button class="next-slide" onclick="mudarSlide(1)">&#10095;</button>
        </div>
    </section>

    <main class="main-content">

        <section class="categories">
            <div class="container">
                <h2>Navegue por categorias</h2>
                <div class="category-grid">
                    <a href="busca.html?categoria=Motor" class="category-card" data-categoria="Motor">
                        <div class="icon-box"><i class="ph ph-engine"></i></div>
                        <span>Motor</span>
                    </a>
                    <a href="busca.html?categoria=Freios" class="category-card" data-categoria="Freios">
                        <div class="icon-box"><i class="ph ph-warning-octagon"></i></div>
                        <span>Freios</span>
                    </a>
                    <a href="busca.html?categoria=Suspens√£o" class="category-card" data-categoria="Suspens√£o">
                        <div class="icon-box"><i class="ph ph-waves"></i></div>
                        <span>Suspens√£o</span>
                    </a>
                    <a href="busca.html?categoria=El√©trica" class="category-card" data-categoria="El√©trica">
                        <div class="icon-box"><i class="ph ph-lightning"></i></div>
                        <span>El√©trica</span>
                    </a>
                    <a href="busca.html?categoria=C√¢mbio" class="category-card" data-categoria="C√¢mbio">
                        <div class="icon-box"><i class="ph ph-gear"></i></div>
                        <span>C√¢mbio</span>
                    </a>
                    <a href="busca.html?categoria=Acess√≥rios" class="category-card" data-categoria="Acess√≥rios">
                        <div class="icon-box"><i class="ph ph-steering-wheel"></i></div>
                        <span>Acess√≥rios</span>
                    </a>
                </div>
            </div>
        </section>
        <section class="promo-section">
            <h2>üî• Produtos em Destaque</h2>
            
            <div id="promocoes-track">
                <p>Carregando produtos...</p>
            </div>
        </section>

    </main>

    <footer class="main-footer">
        <p>¬© 2025 AutoPe√ßas Veloz. Todos os direitos reservados.</p>
    </footer>

    <script>
        // --- L√ìGICA DO SINO NA LOJA ---
        const API_URL_NOTIF = ''; // Defina sua URL se precisar, ou deixe vazia se for relativa

        document.addEventListener('DOMContentLoaded', () => {
            verificarAfiliadoLogado();
        });

        function verificarAfiliadoLogado() {
            const afData = localStorage.getItem('afiliadoLogado');
            
            if (afData) {
                // 1. Mostra o sino
                document.getElementById('box-sino').style.display = 'flex';
                
                // 2. Muda o bot√£o "Entrar" para "Meu Painel" (Opcional, mas fica chique)
                const linkLogin = document.getElementById('link-login');
                if(linkLogin) {
                    const afiliado = JSON.parse(afData);
                    linkLogin.innerHTML = `<i class="ph ph-user-circle"></i><span>${afiliado.nome}</span>`;
                    linkLogin.href = "afiliado_dashboard.html";
                }

                // 3. Busca notifica√ß√µes
                buscarNotificacoes(afData);
                setInterval(() => buscarNotificacoes(afData), 30000); // Atualiza a cada 30s
            }
        }

        async function buscarNotificacoes(jsonString) {
            try {
                const dadosUser = JSON.parse(jsonString);
                const res = await fetch(`${API_URL_NOTIF}/afiliado/notificacoes`, {
                    headers: { 'Authorization': `Bearer ${dadosUser.token}` }
                });
                const dados = await res.json();
                
                const total = dados.mensagens.length + dados.vendas.length;
                const badge = document.getElementById('notif-badge');
                const lista = document.getElementById('notif-list');

                if(total > 0) {
                    badge.style.display = 'flex';
                    badge.innerText = total > 9 ? '9+' : total;
                } else {
                    badge.style.display = 'none';
                }

                lista.innerHTML = '';
                if(total === 0) lista.innerHTML = '<div style="padding:15px; text-align:center; color:#999;">Sem novidades.</div>';

                // Renderiza Vendas
                dados.vendas.forEach(v => {
                    lista.innerHTML += `
                        <div class="notif-item" style="border-left: 3px solid #27ae60;">
                            <i class="ph ph-currency-circle-dollar" style="color:#27ae60; font-size:1.2rem;"></i>
                            <div><strong>Venda Nova!</strong><br>Pedido #${v.id}</div>
                        </div>`;
                });

                // Renderiza Mensagens
                dados.mensagens.forEach(m => {
                    lista.innerHTML += `
                        <div class="notif-item" style="border-left: 3px solid #3498db;">
                            <i class="ph ph-chat-centered-text" style="color:#3498db; font-size:1.2rem;"></i>
                            <div><strong>Admin:</strong> ${m.texto.substring(0, 20)}...</div>
                        </div>`;
                });

            } catch(e) { console.error("Erro no sino:", e); }
        }

        /* ============================================================
       SCRIPT PARA CONTROLAR O MENU DE NOTIFICA√á√ïES (SINO)
       ============================================================ */
    
    // 1. Fun√ß√£o que abre/fecha o menu quando clica no sino
    function abrirNotificacoes() {
        var dropdown = document.getElementById("notif-dropdown");
        
        // Se j√° tiver a classe 'show', tira. Se n√£o tiver, coloca.
        if (dropdown.classList.contains("show")) {
            dropdown.classList.remove("show");
            dropdown.style.display = "none"; // Garante que suma
        } else {
            dropdown.classList.add("show");
            dropdown.style.display = "block"; // Garante que apare√ßa
        }
    }

    // 2. Fun√ß√£o para fechar o menu se clicar em qualquer lugar fora dele
    window.onclick = function(event) {
        // Se o clique N√ÉO foi no sino E N√ÉO foi dentro do menu...
        if (!event.target.matches('.bell-icon') && !event.target.closest('.notification-container')) {
            
            var dropdowns = document.getElementsByClassName("notif-dropdown");
            for (var i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                // Fecha o menu
                if (openDropdown.classList.contains('show') || openDropdown.style.display === "block") {
                    openDropdown.classList.remove('show');
                    openDropdown.style.display = "none";
                }
            }
        }
    }

        async function marcarLidas() {
            const afData = localStorage.getItem('afiliadoLogado');
            if(!afData) return;
            const token = JSON.parse(afData).token;
            
            await fetch(`${API_URL_NOTIF}/afiliado/notificacoes/ler`, {
                method: 'POST', headers: { 'Authorization': `Bearer ${token}` }
            });
            document.getElementById('notif-badge').style.display = 'none';
        }

        // Fecha ao clicar fora
        window.addEventListener('click', (e) => {
            const box = document.getElementById('box-sino');
            const drop = document.getElementById('notif-dropdown');
            if (box && !box.contains(e.target)) {
                drop.style.display = 'none';
            }
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Editar Produto</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <style>
        /* =========================================
           ESTILOS GERAIS (PC)
           ========================================= */
        :root { --primary: #2c3e50; --accent: #e67e22; --bg: #f4f6f8; }
        
        * { box-sizing: border-box; outline: none; } /* Reset Importante */

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; min-height: 100vh; }
        
        /* MENU LATERAL */
        aside { width: 250px; background: var(--primary); color: white; height: 100vh; position: fixed; top: 0; left: 0; z-index: 100; overflow-y: auto; }
        aside h3 { text-align: center; padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); margin: 0; }
        aside nav a { display: flex; align-items: center; gap: 10px; padding: 15px 20px; color: #bdc3c7; text-decoration: none; transition: 0.3s; }
        aside nav a:hover, aside nav a.active { background: rgba(255,255,255,0.1); color: var(--accent); border-left: 4px solid var(--accent); }
        
        /* CONTE√öDO */
        main { margin-left: 250px; padding: 30px; width: 100%; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        /* CARD E FORMUL√ÅRIO */
        .card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 30px; }
        
        /* Estilos do Formul√°rio PC */
        .form-row { display: flex; gap: 20px; margin-bottom: 15px; }
        .form-group { display: flex; flex-direction: column; flex: 1; }
        
        label { font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9rem; }
        
        input, select { 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
            font-size: 1rem; 
            background: #fff;
        }
        input:focus, select:focus { border-color: var(--accent); }

        .btn { padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 1rem; }
        .btn-primary { background: var(--primary); color: white; width: 100%; transition: 0.2s; }
        .btn-primary:hover { background: #34495e; }

        /* =========================================
           üì± MODO MOBILE (ADMIN)
           ========================================= */
        @media (max-width: 768px) {
            body { flex-direction: column; } 

            /* 1. Menu vira topo deslizante */
            aside {
                width: 100%;
                height: auto;
                position: relative;
                padding-bottom: 10px;
                overflow-y: visible;
            }

            aside nav {
                display: flex;
                overflow-x: auto; 
                padding: 0 10px;
                gap: 10px;
                -webkit-overflow-scrolling: touch;
            }
            aside nav::-webkit-scrollbar { display: none; }

            aside nav a {
                flex: 0 0 auto;
                background: rgba(255,255,255,0.1);
                border-radius: 20px;
                padding: 8px 15px;
                border-left: none !important;
                font-size: 0.85rem;
                white-space: nowrap;
            }

            /* 2. Conte√∫do ocupa tudo */
            main {
                margin-left: 0;
                padding: 15px;
                width: 100%;
            }

            /* 3. TRANSFORMA√á√ÉO DO FORMUL√ÅRIO (O Segredo) */
            .form-row {
                display: flex;
                flex-direction: column; /* Um campo embaixo do outro */
                gap: 15px;
                margin-bottom: 15px;
            }

            .form-group {
                width: 100%; /* For√ßa largura total */
            }

            /* Ajuste de inputs para facilitar toque */
            input, select {
                padding: 12px; /* √Årea de toque maior */
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <aside class="sidebar">
            <h3>Admin AutoPe√ßas</h3>
            <nav>
            <a href="admin_dashboard.html"><i class="ph ph-gauge"></i> Dashboard</a>
            <a href="admin_produtos.html" class="active"><i class="ph ph-package"></i> Produtos</a>
            <a href="admin_pedidos.html"><i class="ph ph-shopping-cart-simple"></i> Pedidos</a>
            <a href="admin_afiliados.html"><i class="ph ph-users"></i> Afiliados & Financeiro</a>
            <a href="admin_sugestoes.html"><i class="ph ph-lightbulb"></i> Sugest√µes</a>
                <a href="#" id="logout-button"><i class="ph ph-sign-out"></i> Sair</a>
            </nav>
        </aside>

        <main class="main-content">
            <header>
                <h1>Editar Produto: <span id="edit-produto-id" style="color:var(--accent)">...</span></h1>
            </header>

            <section class="card">
                <h2>Detalhes do Produto</h2>
                <form id="edit-produto-form" class="admin-form">
                    
                    <h3>üì¶ Dados B√°sicos</h3>
                    <div class="form-row">
                        <div class="form-group" style="flex: 2;">
                            <label>T√≠tulo do Produto</label>
                            <input type="text" id="edit-produto-titulo" required>
                        </div>
                        <div class="form-group">
                            <label>Categoria</label>
                            <select id="edit-produto-categoria">
                                <option value="">Selecione...</option>
                                <option value="Motor">Motor</option>
                                <option value="Freios">Freios</option>
                                <option value="Suspens√£o">Suspens√£o</option>
                                <option value="El√©trica">El√©trica</option>
                                <option value="C√¢mbio">C√¢mbio</option>
                                <option value="Acess√≥rios">Acess√≥rios</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Pre√ßo Novo</label>
                            <input type="number" step="0.01" id="edit-produto-preco-novo" required>
                        </div>
                        <div class="form-group">
                            <label>Pre√ßo Antigo</label>
                            <input type="number" step="0.01" id="edit-produto-preco-antigo">
                        </div>
                        <div class="form-group">
                            <label>Estoque</label> <input type="number" id="edit-produto-estoque" required>
                        </div>
                        <div class="form-group">
                            <label>Tag Desconto</label>
                            <input type="text" id="edit-produto-desconto">
                        </div>
                    </div>

                    <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">

                    <h3>üõ†Ô∏è Ficha T√©cnica</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Refer√™ncia (SKU)</label>
                            <input type="text" id="edit-produto-referencia">
                        </div>
                        <div class="form-group">
                            <label>Fabricante</label>
                            <input type="text" id="edit-produto-fabricante">
                        </div>
                        <div class="form-group">
                            <label>URL Logo</label>
                            <input type="text" id="edit-produto-imagem-fabricante">
                        </div>
                    </div>

                    <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">

                    <h3>üöó Compatibilidade</h3>
                    <div class="form-group" style="margin-bottom:15px;">
                        <label>Carros Compat√≠veis</label>
                        <input type="text" id="edit-produto-carros">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ano</label>
                            <input type="text" id="edit-produto-ano">
                        </div>
                        <div class="form-group">
                            <label>Motor</label>
                            <input type="text" id="edit-produto-motor">
                        </div>
                        <div class="form-group">
                            <label>Qtd/Ve√≠culo</label>
                            <input type="number" id="edit-produto-qtd-veiculo">
                        </div>
                    </div>

                    <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">

                    <h3>üñºÔ∏è Imagens e Extras</h3>
                    <div class="form-row">
                        <div class="form-group" style="flex: 2;">
                            <label>URL Imagem Principal</label>
                            <input type="text" id="edit-produto-imagem">
                        </div>
                        <div class="form-group">
                            <label>Palavras-chave</label>
                            <input type="text" id="edit-produto-pesquisa">
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom:15px;">
                        <label style="color: #e67e22; font-weight: bold;">üîó Produtos Relacionados (IDs separados por v√≠rgula)</label>
                        <input type="text" id="edit-produto-relacionados" placeholder="Ex: 12, 45, 88">
                        <small style="color:#666">Coloque aqui os IDs dos produtos que aparecem como sugest√£o (Ex: Coxim, Batente).</small>
                    </div>

                    <div class="form-group" style="margin-bottom:30px;">
                        <label>Outras Imagens (Separadas por v√≠rgula)</label>
                        <input type="text" id="edit-produto-imagens-extra">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
                    </div>
                </form>
            </section>
        </main>
    </div>
    
    <script>
        const API_URL = ''; // Se estiver offline, deixe vazio
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');
        
        document.getElementById('edit-produto-id').innerText = '#' + id;

        // 1. CARREGAR DADOS DO PRODUTO
        async function carregar() {
            const token = localStorage.getItem('adminToken');
            
            // Simula√ß√£o se n√£o tiver API (apenas para n√£o quebrar o teste visual)
            try {
                const res = await fetch(`${API_URL}/products/${id}`);
                const p = await res.json();
                
                document.getElementById('edit-produto-titulo').value = p.titulo;
                document.getElementById('edit-produto-categoria').value = p.categoria || "";
                document.getElementById('edit-produto-preco-novo').value = p.preco_novo;
                document.getElementById('edit-produto-preco-antigo').value = p.preco_antigo || "";
                document.getElementById('edit-produto-estoque').value = p.estoque;
                document.getElementById('edit-produto-desconto').value = p.desconto || "";
                
                document.getElementById('edit-produto-referencia').value = p.referencia || "";
                document.getElementById('edit-produto-fabricante').value = p.fabricante || "";
                document.getElementById('edit-produto-imagem-fabricante').value = p.imagem_fabricante || "";
                
                document.getElementById('edit-produto-carros').value = p.carros || "";
                document.getElementById('edit-produto-ano').value = p.ano || "";
                document.getElementById('edit-produto-motor').value = p.motor || "";
                document.getElementById('edit-produto-qtd-veiculo').value = p.quatidade_por_veiculo || "";
                
                document.getElementById('edit-produto-imagem').value = p.imagem || "";
                document.getElementById('edit-produto-pesquisa').value = p.pesquisa || "";
                document.getElementById('edit-produto-imagens-extra').value = p.imagens_extra || "";
                
                document.getElementById('edit-produto-relacionados').value = p.produtos_relacionados || "";
            } catch (error) {
                console.log("Modo offline ou erro ao buscar: ", error);
            }
        }

        // 2. SALVAR ALTERA√á√ïES
        document.getElementById('edit-produto-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const token = localStorage.getItem('adminToken');
            
            const dados = {
                titulo: document.getElementById('edit-produto-titulo').value,
                categoria: document.getElementById('edit-produto-categoria').value,
                preco_novo: parseFloat(document.getElementById('edit-produto-preco-novo').value),
                preco_antigo: parseFloat(document.getElementById('edit-produto-preco-antigo').value || 0),
                estoque: parseInt(document.getElementById('edit-produto-estoque').value),
                desconto: document.getElementById('edit-produto-desconto').value,
                
                referencia: document.getElementById('edit-produto-referencia').value,
                fabricante: document.getElementById('edit-produto-fabricante').value,
                imagem_fabricante: document.getElementById('edit-produto-imagem-fabricante').value,
                
                carros: document.getElementById('edit-produto-carros').value,
                ano: document.getElementById('edit-produto-ano').value,
                motor: document.getElementById('edit-produto-motor').value,
                quatidade_por_veiculo: parseInt(document.getElementById('edit-produto-qtd-veiculo').value || 1),
                
                imagem: document.getElementById('edit-produto-imagem').value,
                pesquisa: document.getElementById('edit-produto-pesquisa').value,
                imagens_extra: document.getElementById('edit-produto-imagens-extra').value,
                
                produtos_relacionados: document.getElementById('edit-produto-relacionados').value
            };

            try {
                const res = await fetch(`${API_URL}/admin/products/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify(dados)
                });

                if(res.ok) {
                    alert("Produto atualizado com sucesso!");
                    window.location.href = "admin_produtos.html";
                } else {
                    alert("Erro ao salvar.");
                }
            } catch(e) {
                // Simula√ß√£o de sucesso no offline
                alert("Simula√ß√£o: Produto atualizado (Offline)");
                window.location.href = "admin_produtos.html";
            }
        });

        carregar();
    </script>
</body>
</html>
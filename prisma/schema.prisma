generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Admin {
  id    Int     @id @default(autoincrement())
  email String  @unique
  senha String
}

// MODELO AFILIADO (Login por Telefone)
model Afiliado {
  id        Int      @id @default(autoincrement())
  nome      String
  telefone  String   @unique
  senha     String
  codigo    String   @unique
  chavePix  String?
  saldo     Float    @default(0.0)
  aprovado  Boolean  @default(false)
  
  // NOVO: A margem de lucro dele (em %)
  margem    Float    @default(0.0) 

  banco     String?  // Ex: Nubank
  agencia   String?
  conta     String?

  
  pedidos   Pedido[] 
  orcamentos Orcamento[]
  mensagens Mensagem[]
  sugestoes   Sugestao[]
  saques      Saque[]

  createdAt DateTime @default(now())
}

model Produto {
  id                  Int      @id @default(autoincrement())
  titulo              String
  pesquisa            String?
  preco_novo          Float
  preco_antigo        Float?
  desconto            String?
  estoque             Int      @default(0)
  categoria           String?
  referencia          String?
  fabricante          String?
  imagem_fabricante   String?
  carros              String?
  ano                 String?
  motor               String?
  quatidade_por_veiculo Int?
  imagem              String?
  imagens_extra       String?
  produtos_relacionados String?
  tags        String?
  sugestoes   Sugestao[]


  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model Pedido {
  id              Int      @id @default(autoincrement())
  clienteNome     String
  clienteEmail    String
  clienteEndereco String
  clienteTelefone String?
  valorTotal      Float
  itens           String


  
  afiliadoId      Int?     
  afiliado        Afiliado? @relation(fields: [afiliadoId], references: [id])
  comissaoGerada  Float    @default(0.0)
  notificado_afiliado Boolean @default(false)
  status          String   @default("PENDENTE")


  createdAt       DateTime @default(now())
}

model Orcamento {
  id        Int      @id @default(autoincrement())
  nome      String   // Ex: "Orçamento Gol do João"
  itens     String   // Vamos salvar o JSON do carrinho aqui
  total     Float
  
  afiliadoId Int
  afiliado   Afiliado @relation(fields: [afiliadoId], references: [id])
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Mensagem {
  id        Int      @id @default(autoincrement())
  texto     String
  arquivo   String?
  lida      Boolean  @default(false)
  
  afiliadoId Int
  afiliado   Afiliado @relation(fields: [afiliadoId], references: [id])
  
  createdAt DateTime @default(now())
}

model Sugestao {
  id        Int      @id @default(autoincrement())
  termo     String   // O que ele digitou (ex: "Tripoide")
  motivo    String?  // Ex: "Conhecido também como..."
  status    String   @default("PENDENTE") // PENDENTE, APROVADO, REJEITADO
  
  produtoId Int
  produto   Produto  @relation(fields: [produtoId], references: [id])
  
  afiliadoId Int
  afiliado   Afiliado @relation(fields: [afiliadoId], references: [id])
  
  createdAt DateTime @default(now())
}


model Saque {
  id              Int      @id @default(autoincrement())
  valor           Float
  status          String   @default("PENDENTE") // PENDENTE ou PAGO
  dataSolicitacao DateTime @default(now())
  dataPagamento   DateTime?
  comprovante     String?

  afiliadoId      Int
  afiliado        Afiliado @relation(fields: [afiliadoId], references: [id])
}